<html>
<head>
<title>Area.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.ls0 { height: 1px; border-width: 0; color: #4d4d4d; background-color:#4d4d4d}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Area.ipynb</font>
</center></td></tr></table>
<pre><span class="s0">#%% 
</span>
<span class="s1">! pip3 install numpy opencv-python matplotlib imutils scipy pypi</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s2">import </span><span class="s1">cv2</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">math</span>
<span class="s2">from </span><span class="s1">matplotlib </span><span class="s2">import </span><span class="s1">pyplot </span><span class="s2">as </span><span class="s1">plt</span>
<span class="s2">import </span><span class="s1">imutils </span><span class="s2">as </span><span class="s1">im</span>
<span class="s2">from </span><span class="s1">imutils </span><span class="s2">import </span><span class="s1">perspective</span>
<span class="s2">from </span><span class="s1">imutils </span><span class="s2">import </span><span class="s1">contours</span>
<span class="s2">from </span><span class="s1">scipy.spatial </span><span class="s2">import </span><span class="s1">distance </span><span class="s2">as </span><span class="s1">dist</span>
<span class="s2">import </span><span class="s1">ipywidgets </span><span class="s2">as </span><span class="s1">widgets</span>
<span class="s2">import </span><span class="s1">io</span>
<span class="s2">from </span><span class="s1">PIL </span><span class="s2">import </span><span class="s1">Image</span>
<span class="s2">from </span><span class="s1">IPython.display </span><span class="s2">import </span><span class="s1">Image</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Define the size of a reference object</span>
<span class="s0"># Black dot diameter:</span>

<span class="s1">dot_d = </span><span class="s3">22</span><span class="s0"># mm</span>

<span class="s0"># Calculate the area of a reference object</span>

<span class="s1">dot_area = (dot_d/</span><span class="s3">2</span><span class="s1">)**</span><span class="s3">2 </span><span class="s1">* math.pi </span><span class="s0"># mm2</span>
<span class="s1">print(dot_area)</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Define the path to the image</span>

<span class="s1">gel = cv2.imread(</span><span class="s4">f&quot;insert path here&quot;</span><span class="s1">)</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Show original image</span>

<span class="s1">plt.imshow(cv2.cvtColor(gel</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB))</span>
<span class="s1">plt.show()</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Convert image to grayscale and blur it</span>

<span class="s1">gel_gray = cv2.cvtColor(gel</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2GRAY)</span>
<span class="s1">gel_gray_blur = cv2.GaussianBlur(gel_gray</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s3">0</span><span class="s1">) </span><span class="s0"># Tip: set blurring factor (n, m) to minimum to avoid</span>
<span class="s0"># opened contours; change the blurring factors, if needed; use only odd numbers</span>

<span class="s0"># Show the changed image</span>

<span class="s1">plt.imshow(cv2.cvtColor(gel_gray_blur</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB))</span>
<span class="s1">plt.show()</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Edge (contour) detection</span>

<span class="s1">gel_edged = cv2.Canny(gel_gray_blur</span><span class="s2">,</span><span class="s3">10</span><span class="s2">,</span><span class="s3">10</span><span class="s1">)</span>
<span class="s1">gel_edged = cv2.dilate(gel_edged</span><span class="s2">, None, </span><span class="s1">iterations=</span><span class="s3">1</span><span class="s1">)</span>
<span class="s1">gel_edged = cv2.erode(gel_edged</span><span class="s2">, None, </span><span class="s1">iterations=</span><span class="s3">1</span><span class="s1">)</span>

<span class="s0"># Show calculated contours</span>

<span class="s1">plt.imshow(cv2.cvtColor(gel_edged</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB))</span>
<span class="s1">plt.show()</span>

<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Define contours for size calculations</span>

<span class="s2">def </span><span class="s1">get_contours(img):</span>

    <span class="s0"># find all the contours from the B&amp;W image</span>
    <span class="s1">contours</span><span class="s2">, </span><span class="s1">hierarchy = cv2.findContours(img</span><span class="s2">, </span><span class="s1">cv2.RETR_EXTERNAL</span><span class="s2">, </span><span class="s1">cv2.CHAIN_APPROX_SIMPLE)</span>

    <span class="s0"># array with filtered contours of interest</span>
    <span class="s1">final_contours = []</span>

    <span class="s0"># for each contour found</span>
    <span class="s2">for </span><span class="s1">cnt </span><span class="s2">in </span><span class="s1">contours:</span>
        <span class="s0"># find its area in pixel</span>
        <span class="s1">area = cv2.contourArea(cnt)</span>
        <span class="s1">print(</span><span class="s4">&quot;Detected Contour with Area: &quot;</span><span class="s2">, </span><span class="s1">area)</span>

        <span class="s0"># minimum area value is to be fixed as the one that leaves the reference object</span>
        <span class="s0"># as the small object on the scene</span>
        <span class="s2">if </span><span class="s1">area &gt; </span><span class="s3">5000</span><span class="s1">:</span>
            <span class="s1">final_contours.append([area])</span>

    <span class="s0"># check the number of found contours</span>

    <span class="s1">print(</span><span class="s4">&quot;---</span><span class="s2">\n</span><span class="s4">Final number of filtered contours: &quot;</span><span class="s2">, </span><span class="s1">len(final_contours))</span>

    <span class="s2">return </span><span class="s1">final_contours</span>

<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Find contours and calculate the area of the objects in pixel</span>

<span class="s1">final_contours = get_contours(gel_edged)</span>

<span class="s0"># second final contour: coin area in pixel</span>
<span class="s1">coin_size_pixel = str(*final_contours[</span><span class="s3">1</span><span class="s1">])</span>
<span class="s1">print(</span><span class="s4">&quot;Coin Area in pixel&quot;</span><span class="s2">, </span><span class="s1">coin_size_pixel)</span>

<span class="s0"># second final contour: gel area in pixel</span>
<span class="s1">gel_size_pixel = str(*final_contours[</span><span class="s3">0</span><span class="s1">])</span>
<span class="s1">print(</span><span class="s4">&quot;Gel Area in pixel&quot;</span><span class="s2">, </span><span class="s1">gel_size_pixel)</span>

<span class="s0"># Note: reference object is in our case bigger, than the one of the gel. Change contour number</span>
<span class="s0"># if needed (final_contours[1] to final_contours[0] or vice versa) for the right scaling</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Function: convert area in pixel to area in mm2</span>

<span class="s2">def </span><span class="s1">pixel_to_area(gel_pixel</span><span class="s2">, </span><span class="s1">coin_pixel):</span>
    <span class="s0"># how many mm^2 per pixel?</span>
    <span class="s1">area_per_pixel = dot_area / coin_pixel</span>
    <span class="s1">print(</span><span class="s4">&quot;Real area per pixel in mm^2: &quot;</span><span class="s2">, </span><span class="s1">area_per_pixel)</span>
    <span class="s0"># hydrogel area in mm^2:</span>
    <span class="s1">area_mm = area_per_pixel * gel_pixel</span>
    <span class="s2">return </span><span class="s1">area_mm</span>
<hr class="ls0"><span class="s0">#%% 
</span>
<span class="s0"># Calculate the gel area in mm2</span>

<span class="s1">gel_area_mm = pixel_to_area(float(gel_size_pixel)</span><span class="s2">, </span><span class="s1">float(coin_size_pixel))</span>
<span class="s1">print(</span><span class="s4">'Gel area in mm^2: '</span><span class="s2">, </span><span class="s1">gel_area_mm)</span>


</pre>
</body>
</html>